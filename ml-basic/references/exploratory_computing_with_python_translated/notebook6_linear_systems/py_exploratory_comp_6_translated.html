
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Exploratory Computing with Python &#8212; ml-basic</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ml-basic/references/exploratory_computing_with_python_translated/notebook6_linear_systems/py_exploratory_comp_6_translated';</script>
    <link rel="canonical" href="/ml-basic/references/exploratory_computing_with_python_translated/notebook6_linear_systems/py_exploratory_comp_6_translated.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/logo.png" class="logo__image only-light" alt="ml-basic - Home"/>
    <img src="../../../../_static/logo.png" class="logo__image only-dark pst-js-only" alt="ml-basic - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../README.html">
                    Machine Learning Algorithms Guide
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../books/Chapter1.html">机器学习概要</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../books/Chapter2.html">2.有监督学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../books/Chapter3.html">3.无监督学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../books/Chapter4.html">第四章 评估方法和各种数据的处理</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../books/Iris.html">实践应用：</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../books/jupyter_use.html">jupyter 入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../books/LSA.html">例子：简单文档集合的 LSA 处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../books/PCA.html">步骤 1: 数据标准化</a></li>




<li class="toctree-l1"><a class="reference internal" href="../../books/VisibleTools.html">Matplotlib</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fml-basic/references/exploratory_computing_with_python_translated/notebook6_linear_systems/py_exploratory_comp_6_translated.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/ml-basic/references/exploratory_computing_with_python_translated/notebook6_linear_systems/py_exploratory_comp_6_translated.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Exploratory Computing with Python</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Exploratory Computing with Python</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-6">Notebook 6: 线性方程组</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">构建和求解线性方程组</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#left-begin-array-ccc-x-1-2-x-1-1-x-2-2-x-2-1-x-3-2-x-3-1-end-array-right-left-begin-array-c-a-b-c-end-array-right">$
\left(
\begin{array}{ccc}
x_1^2 &amp; x_1 &amp; 1 \
x_2^2 &amp; x_2 &amp; 1 \
x_3^2 &amp; x_3 &amp; 1 \
\end{array}
\right)
\left(
\begin{array}{c}
a \b \c \
\end{array}
\right)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">练习 1. <a name="back1"></a>拟合波形</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">拟合任意多项式</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fpoly">练习 2. <a name="back2"></a><code class="docutils literal notranslate"><span class="pre">fpoly</span></code> 函数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solvepoly">练习 3. <a name="back3"></a><code class="docutils literal notranslate"><span class="pre">solvepoly</span></code> 函数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fpolyeval">练习 4. <a name="back3"></a><code class="docutils literal notranslate"><span class="pre">fpolyeval</span></code> 函数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">一维地下水流动</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">练习 5. <a name="back5"></a>两个沟渠之间的水头</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">固结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">练习 6. 一维固结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">矩阵的逆</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">练习 7. 重新审视一维固结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">稀疏矩阵</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">练习 8：稀疏矩阵</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solutions-to-the-exercises">Solutions to the exercises</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <figure>
  <IMG SRC="https://raw.githubusercontent.com/mbakker7/exploratory_computing_with_python/master/tudelft_logo.png" WIDTH=250 ALIGN="right">
</figure>
<section class="tex2jax_ignore mathjax_ignore" id="exploratory-computing-with-python">
<h1>Exploratory Computing with Python<a class="headerlink" href="#exploratory-computing-with-python" title="Link to this heading">#</a></h1>
<p><em>Developed by Mark Bakker</em></p>
<section id="notebook-6">
<h2>Notebook 6: 线性方程组<a class="headerlink" href="#notebook-6" title="Link to this heading">#</a></h2>
<p>在这篇笔记中，我们学习如何构建和求解线性方程组，并将这些技术应用于解决实际问题。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;inline&#39;</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;numpy&#39;
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>构建和求解线性方程组<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>抛物线由三个点定义（前提是它们不在同一条直线上）。<br />
抛物线的方程为 <span class="math notranslate nohighlight">\(y=ax^2+bx+c\)</span>，其中 <span class="math notranslate nohighlight">\(a\)</span>、<span class="math notranslate nohighlight">\(b\)</span> 和 <span class="math notranslate nohighlight">\(c\)</span> 是常数。<br />
给定三个点 <span class="math notranslate nohighlight">\((x_1,y_1)\)</span>、<span class="math notranslate nohighlight">\((x_2,y_2)\)</span>、<span class="math notranslate nohighlight">\((x_3,y_3)\)</span>，可以编写以下三个线性方程组：</p>
<p><span class="math notranslate nohighlight">\(
\begin{split}
x_1^2a+x_1b+c&amp;=y_1 \\
x_2^2a+x_2b+c&amp;=y_2 \\
x_3^2a+x_3b+c&amp;=y_3 \\
\end{split}
\)</span></p>
<p>或者用矩阵形式表示：</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="left-begin-array-ccc-x-1-2-x-1-1-x-2-2-x-2-1-x-3-2-x-3-1-end-array-right-left-begin-array-c-a-b-c-end-array-right">
<h1>$
\left(
\begin{array}{ccc}
x_1^2 &amp; x_1 &amp; 1 \
x_2^2 &amp; x_2 &amp; 1 \
x_3^2 &amp; x_3 &amp; 1 \
\end{array}
\right)
\left(
\begin{array}{c}
a \b \c \
\end{array}
\right)<a class="headerlink" href="#left-begin-array-ccc-x-1-2-x-1-1-x-2-2-x-2-1-x-3-2-x-3-1-end-array-right-left-begin-array-c-a-b-c-end-array-right" title="Link to this heading">#</a></h1>
<p>\left(
\begin{array}{c}
y_1 \
y_2 \
y_3 \
\end{array}
\right)
$</p>
<p>为了解决这个问题，我们构建一个包含矩阵的二维数组（称为 <code class="docutils literal notranslate"><span class="pre">A</span></code>），以及一个包含右侧的一维数组（称为 <code class="docutils literal notranslate"><span class="pre">rhs</span></code>）。<br />
让我们对三个点 <span class="math notranslate nohighlight">\((x_1,y_1)=(-2,2)\)</span>、<span class="math notranslate nohighlight">\((x_2,y_2)=(1,-1)\)</span>、<span class="math notranslate nohighlight">\((x_3,y_3)=(4,4)\)</span> 进行这个操作。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">xp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span>  <span class="c1"># Store one row at a time</span>
    <span class="n">rhs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Array A:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rhs:&#39;</span><span class="p">,</span><span class="n">rhs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array A:
[[ 4. -2.  1.]
 [ 1.  1.  1.]
 [16.  4.  1.]]
rhs: [ 2. -1.  4.]
</pre></div>
</div>
</div>
</div>
<p>这个系统可以使用 <code class="docutils literal notranslate"><span class="pre">numpy</span></code> 的 <code class="docutils literal notranslate"><span class="pre">linalg</span></code> 子包中的 <code class="docutils literal notranslate"><span class="pre">solve</span></code> 方法进行求解。<code class="docutils literal notranslate"><span class="pre">solve</span></code> 方法接受一个二维数组（矩阵）和一个一维数组（右侧）作为输入，并返回解。为了检查解是否正确，我们需要对存储在数组 <code class="docutils literal notranslate"><span class="pre">A</span></code> 中的矩阵和我们称之为 <code class="docutils literal notranslate"><span class="pre">sol</span></code> 的获得解进行矩阵乘法。
正如我们所学，<code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">*</span> <span class="pre">sol</span></code> 是逐项相乘。对于矩阵乘法，需要使用 <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> 符号（另外，也可以使用 <code class="docutils literal notranslate"><span class="pre">np.dot</span></code> 函数；在 Python 2 中 <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> 符号不起作用）。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;solution is:&#39;</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;specified values of y:&#39;</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A @ sol:&#39;</span><span class="p">,</span> <span class="n">A</span> <span class="o">@</span> <span class="n">sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>solution is: [ 0.44444444 -0.55555556 -0.88888889]
specified values of y: [ 2 -1  4]
A @ sol: [ 2. -1.  4.]
</pre></div>
</div>
</div>
</div>
<p>我们还可以通过绘制这三个点和抛物线来直观检查我们是否正确解决了问题。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sol</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/19d479c8dd16bebda899e97c75e4561dbcb9482b36e6ce01e91a758169b3e0fe.png" src="../../../../_images/19d479c8dd16bebda899e97c75e4561dbcb9482b36e6ce01e91a758169b3e0fe.png" />
</div>
</div>
<section id="id2">
<h2>练习 1. <a name="back1"></a>拟合波形<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>考虑以下四个在时间 <span class="math notranslate nohighlight">\(t\)</span> 处的 <span class="math notranslate nohighlight">\(y\)</span> 量测值：<span class="math notranslate nohighlight">\((t_0,y_0)=(0,3)\)</span>、<span class="math notranslate nohighlight">\((t_1,y_1)=(0.25,1)\)</span>、<span class="math notranslate nohighlight">\((t_2,y_2)=(0.5,-3)\)</span>、<span class="math notranslate nohighlight">\((t_3,y_3)=(0.75,1)\)</span>。这些测量值是可以表示为以下波形的一部分：</p>
<p><span class="math notranslate nohighlight">\(y = a\cos(\pi t) + b\cos(2\pi t) + c\cos(3\pi t) + d\cos(4\pi t)\)</span></p>
<p>其中 <span class="math notranslate nohighlight">\(a\)</span>、<span class="math notranslate nohighlight">\(b\)</span>、<span class="math notranslate nohighlight">\(c\)</span> 和 <span class="math notranslate nohighlight">\(d\)</span> 是参数。构建一个包含四个线性方程的系统，并求解这四个参数。创建一个波形图，其中 <span class="math notranslate nohighlight">\(t\)</span> 从 0 到 1，并用点表示这四个测量值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
    <span class="n">rhs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;solution is:&#39;</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;specified values of y:&#39;</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A @ sol:&#39;</span><span class="p">,</span> <span class="n">A</span> <span class="o">@</span> <span class="n">sol</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sol</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sol</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>solution is: [ 1.  2.  1. -1.]
specified values of y: [ 3  1 -3  1]
A @ sol: [ 3.  1. -3.  1.]
</pre></div>
</div>
<img alt="../../../../_images/03bb9cabc986ebd6c4e9d25b5cf2aab83206dc67114fcaa5310a9943235d633a.png" src="../../../../_images/03bb9cabc986ebd6c4e9d25b5cf2aab83206dc67114fcaa5310a9943235d633a.png" />
</div>
</div>
<p><a href="#ex1answer">Answers to Exercise 1</a></p>
</section>
<section id="id3">
<h2>拟合任意多项式<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>在接下来的三个练习中，我们将拟合一个任意阶数 <span class="math notranslate nohighlight">\(N\)</span> 的多项式到一组 <span class="math notranslate nohighlight">\(N+1\)</span> 个数据点。我们要拟合的函数是</p>
<div class="math notranslate nohighlight">
\[f(x) = a_0 + a_1x + a_2x^2 + ... + a_Nx^N = \sum\limits_{n=0}^{N}a_nx^n\]</div>
<p>请注意，有 <span class="math notranslate nohighlight">\(N+1\)</span> 个参数 <span class="math notranslate nohighlight">\(a_n\)</span>，而多项式的阶数称为 <span class="math notranslate nohighlight">\(N\)</span>。</p>
</section>
<section id="fpoly">
<h2>练习 2. <a name="back2"></a><code class="docutils literal notranslate"><span class="pre">fpoly</span></code> 函数<a class="headerlink" href="#fpoly" title="Link to this heading">#</a></h2>
<p>首先，编写一个名为 <code class="docutils literal notranslate"><span class="pre">fpoly</span></code> 的函数，该函数返回一个数组，其中第 <span class="math notranslate nohighlight">\(n\)</span> 项等于 <span class="math notranslate nohighlight">\(x^n\)</span>。该函数的输入参数为 <span class="math notranslate nohighlight">\(x\)</span> 的值和多项式的阶数 <span class="math notranslate nohighlight">\(N\)</span>。函数的输出是一个长度为 <span class="math notranslate nohighlight">\(N+1\)</span> 的数组。通过执行以下代码来测试你的函数，当 <span class="math notranslate nohighlight">\(x=2\)</span> 和 <span class="math notranslate nohighlight">\(N=4\)</span> 时：</p>
<p><code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">fpoly(2,</span> <span class="pre">4)</span></code></p>
<p>这应该返回 <code class="docutils literal notranslate"><span class="pre">[</span>&#160; <span class="pre">1.</span>&#160;&#160; <span class="pre">2.</span>&#160;&#160; <span class="pre">4.</span>&#160;&#160; <span class="pre">8.</span>&#160; <span class="pre">16.]</span></code>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fpoly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">rv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">rv</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fpoly</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.  2.  4.  8. 16.]
</pre></div>
</div>
</div>
</div>
<p><a href="#ex2answer">Answers to Exercise 2</a></p>
</section>
<section id="solvepoly">
<h2>练习 3. <a name="back3"></a><code class="docutils literal notranslate"><span class="pre">solvepoly</span></code> 函数<a class="headerlink" href="#solvepoly" title="Link to this heading">#</a></h2>
<p>接下来，编写一个函数来计算参数 <span class="math notranslate nohighlight">\(a_n\)</span>，以拟合一个经过 <span class="math notranslate nohighlight">\(N+1\)</span> 个数据点的阶数为 <span class="math notranslate nohighlight">\(N\)</span> 的多项式。将该函数命名为 <code class="docutils literal notranslate"><span class="pre">solvepoly</span></code>。函数的输入参数是一个长度为 <span class="math notranslate nohighlight">\(N+1\)</span> 的数组 <span class="math notranslate nohighlight">\(x\)</span> 和一个长度为 <span class="math notranslate nohighlight">\(N+1\)</span> 的数组 <span class="math notranslate nohighlight">\(y\)</span>。输出是一个参数数组 <span class="math notranslate nohighlight">\(a_n\)</span>，使得阶数为 <span class="math notranslate nohighlight">\(N\)</span> 的多项式恰好通过 <span class="math notranslate nohighlight">\(N+1\)</span> 个数据点 <span class="math notranslate nohighlight">\(x\)</span> 和 <span class="math notranslate nohighlight">\(y\)</span>。</p>
<p>在函数内部，你需要计算一个 <span class="math notranslate nohighlight">\(N+1\)</span> 个方程的矩阵，以求解 <span class="math notranslate nohighlight">\(N+1\)</span> 个未知参数。对于矩阵的每一行，调用 <code class="docutils literal notranslate"><span class="pre">fpoly</span></code> 函数。通过执行以下四个命令来测试你的函数。如果你的代码正确，参数数组 <code class="docutils literal notranslate"><span class="pre">a</span></code> 应为 <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">3.</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">2.33333333</span> <span class="pre">-6.</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">1.66666667]</span></code>。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>xp = np.array([0, 1, 2, 3])
yp = np.array([3, 1, -3, 1])
a = solvepoly(xp, yp)
print(a)
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solvepoly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">solvepoly</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.66666667 -6.          2.33333333  3.        ]
</pre></div>
</div>
</div>
</div>
<p><a href="#ex3answer">Answers to Exercise 3</a></p>
</section>
<section id="fpolyeval">
<h2>练习 4. <a name="back3"></a><code class="docutils literal notranslate"><span class="pre">fpolyeval</span></code> 函数<a class="headerlink" href="#fpolyeval" title="Link to this heading">#</a></h2>
<p>最后，编写一个名为 <code class="docutils literal notranslate"><span class="pre">fpolyeval</span></code> 的函数，以评估函数 <span class="math notranslate nohighlight">\(f(x) = \sum\limits_{n=0}^{N}a_nx^n\)</span>，给定参数 <span class="math notranslate nohighlight">\(a\)</span> 和一组 <span class="math notranslate nohighlight">\(x\)</span> 值。<code class="docutils literal notranslate"><span class="pre">fpolyeval</span></code> 函数接受一个任意长度的数组 <span class="math notranslate nohighlight">\(x\)</span> 和一个长度为 <span class="math notranslate nohighlight">\(N+1\)</span> 的参数数组 <span class="math notranslate nohighlight">\(a\)</span> 作为输入参数。该函数返回一个长度与 <span class="math notranslate nohighlight">\(x\)</span> 相同的 <span class="math notranslate nohighlight">\(f(x)\)</span> 值数组。</p>
<p>首先，通过执行以下代码测试你的函数：</p>
<p><code class="docutils literal notranslate"><span class="pre">fpolyeval(xp,</span> <span class="pre">a)</span></code></p>
<p>其中 <code class="docutils literal notranslate"><span class="pre">xp</span></code> 是在练习 3 中输入的值的数组，<code class="docutils literal notranslate"><span class="pre">a</span></code> 是在练习 3 中计算的参数。当你正确编写所有代码时，该函数应该返回练习 3 中指定的四个值 <code class="docutils literal notranslate"><span class="pre">yp</span></code>。进一步测试你的函数，通过运行以下命令，这应该将练习 3 中的四个数据点作为标记绘制出来，并绘制经过这四个点的 3 次多项式。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x = np.linspace(-1, 4, 100)
y = fpolyeval(x, a)
plt.plot(xp, yp, &#39;ko&#39;, label=&#39;data&#39;)
plt.plot(x, y, label=&#39;fitted poly&#39;)
plt.legend(loc=&#39;best&#39;);
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">fpolyeval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;评估多项式 f(x) = sum(a_n * x^n)&quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># 累加每一项</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.33333333</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">1.66666667</span><span class="p">])</span> 

<span class="n">evaluated_values</span> <span class="o">=</span> <span class="n">fpolyeval</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">fpolyeval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fitted poly&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/76591c66c0e7e85a3a821bcd0dbaf325b5b409ad8ed910183319aabf39a519cd.png" src="../../../../_images/76591c66c0e7e85a3a821bcd0dbaf325b5b409ad8ed910183319aabf39a519cd.png" />
</div>
</div>
<p><a href="#ex4answer">Answers to Exercise 4</a></p>
</section>
<section id="id4">
<h2>一维地下水流动<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>考虑一个被粘土层覆盖的沙层。沙层两侧各有一个水位固定的沟渠，左侧水位为 <span class="math notranslate nohighlight">\(h_1^*\)</span>，右侧水位为 <span class="math notranslate nohighlight">\(h_2^*\)</span>；两个沟渠之间的距离为 <span class="math notranslate nohighlight">\(L\)</span>。水通过粘土层以恒定速率 <span class="math notranslate nohighlight">\(P\)</span> 渗漏（见图）。沙层中的地下水头由以下二阶常微分方程控制：</p>
<div class="math notranslate nohighlight">
\[\frac{\text{d}^2h}{\text{d}x^2} = -\frac{P}{kD}\]</div>
<p>其中 <span class="math notranslate nohighlight">\(h\)</span> 是水头，<span class="math notranslate nohighlight">\(k\)</span> 是沙层的水力导率，<span class="math notranslate nohighlight">\(D\)</span> 是沙层的厚度。边界条件为 <span class="math notranslate nohighlight">\(h=h_1^*\)</span> 在 <span class="math notranslate nohighlight">\(x=0\)</span> 和 <span class="math notranslate nohighlight">\(h=h_2^*\)</span> 在 <span class="math notranslate nohighlight">\(x=L\)</span>。</p>
<img src="http://i.imgur.com/2DH0sxT.png" alt="Consolidation" width=400pt>
<p>虽然这个问题可以精确求解，但我们将在这里使用有限差分法进行数值求解（这也允许 <span class="math notranslate nohighlight">\(P\)</span> 是 <span class="math notranslate nohighlight">\(x\)</span> 的函数，例如）。水头在从 <span class="math notranslate nohighlight">\(x=0\)</span> 到 <span class="math notranslate nohighlight">\(x=L\)</span> 的 <span class="math notranslate nohighlight">\(N+1\)</span> 个等间距点处计算。这些点标记为 <span class="math notranslate nohighlight">\(x_0\)</span> 到 <span class="math notranslate nohighlight">\(x_{N}\)</span>，其中 <span class="math notranslate nohighlight">\(x_n=n\Delta x\)</span>，<span class="math notranslate nohighlight">\(\Delta x\)</span> 是点之间的水平距离。点 <span class="math notranslate nohighlight">\(x_n\)</span> 处的水头称为 <span class="math notranslate nohighlight">\(h_n\)</span>。二阶导数可以近似为（见 e.g. Verrujt (2012) Soil Mechanics, Eq. 17.4；可以在 <a class="reference external" href="http://geo.verruijt.net/">这里</a> 找到这本书的完整 PDF 链接）。</p>
<div class="math notranslate nohighlight">
\[\frac{\text{d}^2h}{\text{d}x^2} \approx \frac{1}{\Delta x} \left[ \frac{h_{n+1}-h_n}{\Delta x} - \frac{h_{n}-h_{n-1}}{\Delta x} \right]= \frac{h_{n-1}-2h_n+h_{n+1}}{(\Delta x)^2}\]</div>
<p>将这一导数近似代入微分方程并重新排列项得到</p>
<div class="math notranslate nohighlight">
\[h_{n-1}-2h_n+h_{n+1} = -P\frac{(\Delta x)^2}{kD}\]</div>
<p>对于每个点 <span class="math notranslate nohighlight">\(n\)</span> 都可以写出这样的方程，除了第一个和最后一个点，在那里我们需要应用边界条件：</p>
<div class="math notranslate nohighlight">
\[h_0=h_1^* \qquad h_N=h_2^*\]</div>
<p>当 <span class="math notranslate nohighlight">\(N=4\)</span> 时，我们需要求解一个包含 <span class="math notranslate nohighlight">\(N+1=5\)</span> 个线性方程的系统，未知数为 <span class="math notranslate nohighlight">\(h_0\)</span> 到 <span class="math notranslate nohighlight">\(h_4\)</span>：</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
h_0 &amp;= h_1^*  \\
h_{0}-2h_1+h_{2} &amp;= -P\frac{(\Delta x)^2}{kD} \\
h_{1}-2h_2+h_{3} &amp;= -P\frac{(\Delta x)^2}{kD} \\
h_{2}-2h_3+h_{4} &amp;= -P\frac{(\Delta x)^2}{kD} \\
h_4 &amp;= h_2^* 
\end{split}\end{split}\]</div>
<p>或者用矩阵形式表示为</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left(
\begin{array}{ccccc}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; -2 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; -2 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; -2 &amp; 1 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
\end{array}
\right)
\left(
\begin{array}{c}
h_0 \\
h_1 \\
h_2 \\
h_3 \\
h_4 \\
\end{array}
\right)
=
\left(
\begin{array}{c}
h_1^* \\
-P\frac{(\Delta x)^2}{kD} \\
-P\frac{(\Delta x)^2}{kD} \\
-P\frac{(\Delta x)^2}{kD} \\
h_2^* \\
\end{array}
\right)
\end{split}\]</div>
<p>请注意，矩阵主要由零组成。该矩阵称为三对角矩阵，因为只有在矩阵的三条对角线上有值。可以通过指定对角线的值和位置来构建矩阵。主对角线的位置编号为零，长度为 <span class="math notranslate nohighlight">\(N+1\)</span>。主对角线正上的对角线的位置编号为 <span class="math notranslate nohighlight">\(+1\)</span>，长度为 <span class="math notranslate nohighlight">\(N\)</span>；而主对角线下方的对角线的位置编号为 <span class="math notranslate nohighlight">\(-1\)</span>，长度也为 <span class="math notranslate nohighlight">\(N\)</span>。<code class="docutils literal notranslate"><span class="pre">np.diag</span></code> 函数创建一个只包含一条对角线的矩阵。输入参数是一个具有正确长度的数组，其中包含对角线上的值和对角线的位置。可以按如下方式构建矩阵：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># main diagonal</span>
<span class="n">d0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># first value of main diagonal is 1</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># last value of main diagonal is 1</span>
<span class="n">dplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># diagonal right above main diagonal, position 1</span>
<span class="n">dplus1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># first value of diagonal is 0</span>
<span class="n">dmin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># diagonal right below main diagonal, position -1</span>
<span class="n">dmin1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># last value of diagonal is 0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dplus1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dmin1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 1.  0.  0.  0.  0.]
 [ 1. -2.  1.  0.  0.]
 [ 0.  1. -2.  1.  0.]
 [ 0.  0.  1. -2.  1.]
 [ 0.  0.  0.  0.  1.]]
</pre></div>
</div>
</div>
</div>
<p>请注意，上述描述的有限差分法在使用合理数量的点时是准确的。四个点可能不够。你可以通过例如将点数加倍并比较两个解来判断是否使用了足够的点。</p>
</section>
<section id="id5">
<h2>练习 5. <a name="back5"></a>两个沟渠之间的水头<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>计算沙层中的水头分布，该沙层两侧各有一个沟渠。给定参数：<span class="math notranslate nohighlight">\(k=10\)</span> m/day，<span class="math notranslate nohighlight">\(D=10\)</span> m，<span class="math notranslate nohighlight">\(h_1^*=20\)</span> m，<span class="math notranslate nohighlight">\(h_2^*=22\)</span> m，<span class="math notranslate nohighlight">\(L=1000\)</span> m，<span class="math notranslate nohighlight">\(P=0.001\)</span> m/d。使用 <span class="math notranslate nohighlight">\(N=40\)</span>。编写 Python 代码以：</p>
<ul class="simple">
<li><p>求解所有 <span class="math notranslate nohighlight">\(N+1\)</span> 点的水头</p></li>
<li><p>打印两个沟渠之间的水头最大值（约为 22.5）</p></li>
<li><p>创建水头与 <span class="math notranslate nohighlight">\(x\)</span> 的关系图，并标记坐标轴。</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">D</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">h1</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">h2</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dplus1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dmin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dmin1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dplus1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dmin1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">delX</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">P</span> <span class="o">*</span> <span class="n">delX</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">k</span> <span class="o">/</span> <span class="n">D</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span>
<span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h2</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;head (m)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum head &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>maximum head  22.449999999999896
</pre></div>
</div>
<img alt="../../../../_images/6c58b378ae9fb4b86b53555220d684ae7e8bee57f3b5d4f0bd44643b3b104273.png" src="../../../../_images/6c58b378ae9fb4b86b53555220d684ae7e8bee57f3b5d4f0bd44643b3b104273.png" />
</div>
</div>
<p><a href="#ex5answer">Answers to Exercise 5</a></p>
</section>
<section id="id6">
<h2>固结<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<p>饱和粘土的变形是一个缓慢的过程，称为固结。在土壤压缩过程中，孔隙率减少，因此可供孔隙水使用的空间变小。因此，在压缩过程中，需要将一些孔隙水排出土壤。由于粘土的渗透性较小，这可能需要相当长的时间。有关固结过程的详细描述可以在 Verruijt 2012 年的《土壤力学》第 15-17 章中找到，见此 <a class="reference external" href="http://geo.verruijt.net/">链接</a>。</p>
<p>考虑高度为 <span class="math notranslate nohighlight">\(h\)</span> 的土壤中的一维固结。土壤样本中的水压力 <span class="math notranslate nohighlight">\(p\)</span> 由下述微分方程控制：</p>
<div class="math notranslate nohighlight">
\[\frac{\partial p}{\partial t} = c_v \frac{\partial^2 p}{\partial z^2}\]</div>
<p>其中 <span class="math notranslate nohighlight">\(z\)</span> 是垂直坐标（向上为正），<span class="math notranslate nohighlight">\(c_v\)</span> 是固结系数。我们考虑水可以从顶部排出，但不能从底部排出的情况，因此底部的边界条件为：</p>
<div class="math notranslate nohighlight">
\[z=0 \qquad \frac{\partial p}{\partial z} = 0\]</div>
<p>顶部的边界条件为：</p>
<div class="math notranslate nohighlight">
\[z=h \qquad p = 0\]</div>
<p>在时间 <span class="math notranslate nohighlight">\(t=0\)</span> 时施加一个恒定荷载，导致土壤样本内部初始呈现均匀压力 <span class="math notranslate nohighlight">\(q\)</span>（除了在 <span class="math notranslate nohighlight">\(z=0\)</span> 的位置，那里压力始终为零）：</p>
<div class="math notranslate nohighlight">
\[t=0 \qquad p = q\]</div>
<img src="http://i.imgur.com/4xdeoxw.png" alt="固结" width=400pt><p>土壤中压力随时间的变化是通过数值方法（准确地说是完全隐式有限差分法）进行模拟的。压力在 <span class="math notranslate nohighlight">\(N+1\)</span> 个点上进行计算，这些点均匀分布在 <span class="math notranslate nohighlight">\(z=0\)</span> 到 <span class="math notranslate nohighlight">\(z=h\)</span> 之间。点的标记为 <span class="math notranslate nohighlight">\(z_0\)</span> 到 <span class="math notranslate nohighlight">\(z_{N}\)</span>，其中 <span class="math notranslate nohighlight">\(z_n=n\Delta z\)</span>，<span class="math notranslate nohighlight">\(\Delta z\)</span> 是点之间的垂直距离。在点 <span class="math notranslate nohighlight">\(z_n\)</span> 处的压力称为 <span class="math notranslate nohighlight">\(p_n\)</span>。每个时间步长 <span class="math notranslate nohighlight">\(\Delta t\)</span> 都会计算一个独立的解。时间导数的近似为：</p>
<div class="math notranslate nohighlight">
\[\frac{\partial p}{\partial t} \approx \frac{p_n(t) - p_n(t-\Delta t)}{\Delta t}\]</div>
<p>而空间导数的近似为：</p>
<div class="math notranslate nohighlight">
\[\frac{\partial^2 p}{\partial z^2} \approx \frac{p_{n-1}(t) -2p_n(t) + p_{n+1}(t)}{(\Delta z)^2}\]</div>
<p>将这些导数的近似值代入并整理得到以下方程：</p>
<div class="math notranslate nohighlight">
\[p_{n-1}(t) - (2+\mu)p_n(t) + p_{n+1}(t) = -\mu p_n(t-\Delta t)\]</div>
<p>其中</p>
<div class="math notranslate nohighlight">
\[\mu = \frac{(\Delta z)^2}{c_v \Delta t}\]</div>
<p>这是一个关于时间 <span class="math notranslate nohighlight">\(t\)</span> 的压力方程，涉及点 <span class="math notranslate nohighlight">\((n-1)\)</span>、<span class="math notranslate nohighlight">\(n\)</span> 和 <span class="math notranslate nohighlight">\((n+1)\)</span>，假设在时间 <span class="math notranslate nohighlight">\(t-\Delta t\)</span> 的压力已知。</p>
<p>对于 <span class="math notranslate nohighlight">\(n=0\)</span> 和 <span class="math notranslate nohighlight">\(n=N\)</span> 的方程是不同的。
在样本底部（<span class="math notranslate nohighlight">\(n=0\)</span>），边界条件为 <span class="math notranslate nohighlight">\(\partial p/\partial z = 0\)</span>。可以在 <span class="math notranslate nohighlight">\(z_0=0\)</span> 处近似计算导数为：</p>
<div class="math notranslate nohighlight">
\[\left(\frac{\partial p}{\partial z}\right)_{z=0} \approx \frac{(p_1-p_{-1})}{2\Delta z}=0\]</div>
<p>其中 <span class="math notranslate nohighlight">\(p_{-1}\)</span> 是 <span class="math notranslate nohighlight">\(z_0\)</span> 下方 <span class="math notranslate nohighlight">\(\Delta z\)</span> 处的压力。导数为零时 <span class="math notranslate nohighlight">\(p_{-1}=p_1\)</span>，代入 <span class="math notranslate nohighlight">\(n=0\)</span> 的方程可得：</p>
<div class="math notranslate nohighlight">
\[- (2+\mu)p_n(t) + 2p_{n+1}(t) = -\mu p_n(t-\Delta t)\]</div>
<p>对于 <span class="math notranslate nohighlight">\(n=N\)</span> 的方程则更简单，因为在样本顶部（<span class="math notranslate nohighlight">\(n=N\)</span>），压力固定为 <span class="math notranslate nohighlight">\(p_N=0\)</span>。</p>
<p>作为一个例子，对于 <span class="math notranslate nohighlight">\(N=4\)</span> 的方程系统为：</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left(
\begin{array}{ccccc}
-(2+\mu) &amp; 2 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; -(2+\mu) &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; -(2+\mu) &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; -(2+\mu) &amp; 1 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
\end{array}
\right)
\left(
\begin{array}{c}
p_0(t) \\
p_1(t) \\
p_2(t) \\
p_3(t) \\
p_4(t) \\
\end{array}
\right)
=
\left(
\begin{array}{c}
-\mu p_0(t-\Delta t) \\
-\mu p_1(t-\Delta t) \\
-\mu p_2(t-\Delta t) \\
-\mu p_3(t-\Delta t) \\
0 \\
\end{array}
\right)
\end{split}\]</div>
<p>通过逐步进行时间计算获得解。矩阵只需计算一次，因为它在时间上是恒定的。每个时间步长，需要计算新的右侧并求解一个包含 <span class="math notranslate nohighlight">\(N+1\)</span> 个方程的线性系统。如果将矩阵称为 <span class="math notranslate nohighlight">\(A\)</span>，而基于 <span class="math notranslate nohighlight">\(t-\Delta t\)</span> 时的压力构造的右侧向量称为 <span class="math notranslate nohighlight">\(\vec{r}(t-\Delta t)\)</span>，那么在时间 <span class="math notranslate nohighlight">\(t\)</span> 时的压力 <span class="math notranslate nohighlight">\(\vec{p}(t)\)</span> 通过解决系统</p>
<div class="math notranslate nohighlight">
\[A\vec{p}(t) = \vec{r}(t-\Delta t)\]</div>
<p>来获得。</p>
<p>请注意，所呈现的数值解法是近似的，仅在时间步长 <span class="math notranslate nohighlight">\(\Delta t\)</span> 和空间离散化 <span class="math notranslate nohighlight">\(\Delta z\)</span> 选择足够小的情况下，才能给出准确的解。</p>
</section>
<section id="id7">
<h2>练习 6. 一维固结<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<p>考虑一个厚度为 2 米的粘土层的固结过程。在时间 ( t=0 ) 时施加均匀荷载，导致压力单位增加，即 ( p(t=0)=1 )。粘土的固结系数为 ( c_v=1 \cdot 10^{-6} ) m²/s。使用上述数值方法模拟固结过程。设定 ( N=40 ) 和时间步长 ( \Delta t=4 \cdot 10^4 ) 秒。进行 50 次时间步长的计算，并在每 10 次时间步长时绘制粘土中的压力分布。添加坐标轴标签和图例。将你的解与 Veruit (2012) 图 16.2 中的图形进行比较（注意，Verruijt 将 ( p ) 绘制在水平轴上）。你的图的最后一行应近似于 Verrujt 图中的线 ( c_v t / h^2=0.5 )。</p>
<p>确保你的 Python 代码：</p>
<ul class="simple">
<li><p>计算所有 50 次时间步长的所有 ( N+1 ) 点的压力，并在 10、20、30、40 和 50 次时间步长后绘制结果。</p></li>
<li><p>在 10、20、30、40 和 50 次时间步长后，将最大压力值打印到屏幕上。</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">delt</span> <span class="o">=</span> <span class="mf">4e4</span>
<span class="c1">#</span>
<span class="n">delz</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">delz</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">cv</span> <span class="o">*</span> <span class="n">delt</span><span class="p">)</span>

<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dm1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dp1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">*</span> <span class="n">p</span>
        <span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">delz</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; timesteps&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum value after&#39;</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;timesteps is:&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Consolidation&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>maximum value after 10 timesteps is: 0.9425826615266134
maximum value after 20 timesteps is: 0.7742325163427506
maximum value after 30 timesteps is: 0.6117657473484334
maximum value after 40 timesteps is: 0.4801227573807983
maximum value after 50 timesteps is: 0.37636878032217186
</pre></div>
</div>
<img alt="../../../../_images/c10f52fc679d6b72a25103ddc64684e874952df052fe5e5fceddd99d712d3694.png" src="../../../../_images/c10f52fc679d6b72a25103ddc64684e874952df052fe5e5fceddd99d712d3694.png" />
</div>
</div>
<p><a href="#ex6answer">Answers to Exercise 6</a></p>
</section>
<section id="id8">
<h2>矩阵的逆<a class="headerlink" href="#id8" title="Link to this heading">#</a></h2>
<p>如前所述，矩阵 <code class="docutils literal notranslate"><span class="pre">A</span></code> 的值在时间上不发生变化。因此，计算并存储矩阵的逆比反复调用 <code class="docutils literal notranslate"><span class="pre">np.linalg.solve</span></code> 方法更有效。可以使用 <code class="docutils literal notranslate"><span class="pre">linalg</span></code> 包中的 <code class="docutils literal notranslate"><span class="pre">inv</span></code> 函数来计算矩阵的逆。如果矩阵 <code class="docutils literal notranslate"><span class="pre">A</span></code> 的逆称为 <code class="docutils literal notranslate"><span class="pre">Ainv</span></code>，那么压力的解可以通过矩阵乘法将 <code class="docutils literal notranslate"><span class="pre">Ainv</span></code> 与右侧相乘来获得。例如，在本笔记本中的第一个问题中，通过三个点拟合抛物线，可以按如下方式计算矩阵的逆以获得解：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">16</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">Ainv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">Ainv</span> <span class="o">@</span> <span class="n">rhs</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sol:&#39;</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sol: [ 0.44444444 -0.55555556 -0.88888889]
</pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h2>练习 7. 重新审视一维固结<a class="headerlink" href="#id9" title="Link to this heading">#</a></h2>
<p>修改你的第 6 题解决方案，通过计算并存储矩阵的逆，然后通过将矩阵的逆与右侧向量相乘来计算解。这样可以提高计算效率。确保你的代码在每个时间步长后输出压力分布，并在指定的时间步长后打印最大压力值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># m^2/s</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># m</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">delt</span> <span class="o">=</span> <span class="mf">4e4</span>  <span class="c1"># seconds</span>
<span class="c1">#</span>
<span class="n">delz</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">delz</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">cv</span> <span class="o">*</span> <span class="n">delt</span><span class="p">)</span>

<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dm1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dp1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Ainv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">*</span> <span class="n">p</span>
        <span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Ainv</span> <span class="o">@</span> <span class="n">rhs</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">delz</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; timesteps&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum value after&#39;</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;timesteps is:&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Consolidation&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>maximum value after 10 timesteps is: 0.9425826615266134
maximum value after 20 timesteps is: 0.7742325163427506
maximum value after 30 timesteps is: 0.611765747348433
maximum value after 40 timesteps is: 0.48012275738079746
maximum value after 50 timesteps is: 0.37636878032217125
</pre></div>
</div>
<img alt="../../../../_images/c10f52fc679d6b72a25103ddc64684e874952df052fe5e5fceddd99d712d3694.png" src="../../../../_images/c10f52fc679d6b72a25103ddc64684e874952df052fe5e5fceddd99d712d3694.png" />
</div>
</div>
<p><a href="#ex7answer">Answers to Exercise 7</a></p>
</section>
<section id="id10">
<h2>稀疏矩阵<a class="headerlink" href="#id10" title="Link to this heading">#</a></h2>
<p>我们迄今为止用于构造有限差分解的矩阵的过程效率不高，因为创建了一个主要由零组成的完整矩阵。非零值仅出现在三个对角线上。更有效的例程存储被称为 <em>稀疏矩阵</em>。在稀疏矩阵中，仅存储矩阵中非零值的位置和数值。<code class="docutils literal notranslate"><span class="pre">scipy.sparse</span></code> 包中提供了稀疏矩阵的功能。可以使用 <code class="docutils literal notranslate"><span class="pre">diags</span></code> 函数从对角线创建稀疏矩阵，该函数接受一个包含对角线数组的列表和一个包含对角线编号的列表。例如，矩阵</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left(
\begin{array}{cccc}
2 &amp; 3 &amp; 0 &amp; 0 \\
1 &amp; 2 &amp; 3 &amp; 0 \\
0 &amp; 1 &amp; 2 &amp; 3 \\
0 &amp; 0 &amp; 1 &amp; 2 \\
\end{array}
\right)
\end{split}\]</div>
<p>可以这样创建：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">diags</span><span class="p">([</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> 
              <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> 
              <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span> 
             <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csc&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sparse matrix A&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="c1"># Gives the way A is stored: row, column, value</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Full matrix A as an array&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>  <span class="c1"># Returns the equivalent full array</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sparse matrix A
&lt;Compressed Sparse Column sparse matrix of dtype &#39;float64&#39;
	with 10 stored elements and shape (4, 4)&gt;
  Coords	Values
  (1, 0)	1.0
  (0, 0)	2.0
  (2, 1)	1.0
  (1, 1)	2.0
  (0, 1)	3.0
  (3, 2)	1.0
  (2, 2)	2.0
  (1, 2)	3.0
  (3, 3)	2.0
  (2, 3)	3.0
Full matrix A as an array
[[2. 3. 0. 0.]
 [1. 2. 3. 0.]
 [0. 1. 2. 3.]
 [0. 0. 1. 2.]]
</pre></div>
</div>
</div>
</div>
<p>有多种方法可以存储稀疏矩阵。在上述代码中，稀疏矩阵 <code class="docutils literal notranslate"><span class="pre">A</span></code> 以 <em>压缩稀疏列</em> 格式存储（指定为 <code class="docutils literal notranslate"><span class="pre">'csc'</span></code>）。这种格式的优缺点可以在 <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csc_matrix.html">这里</a> 找到。<code class="docutils literal notranslate"><span class="pre">A</span></code> 现在是一个稀疏矩阵对象。（注意，对于稀疏矩阵对象，乘法符号并不是进行逐项相乘。）通过 <code class="docutils literal notranslate"><span class="pre">scipy.sparse.linalg</span></code> 模块的 <code class="docutils literal notranslate"><span class="pre">spsolve</span></code> 函数，可以得到方程组 <span class="math notranslate nohighlight">\(Ax=b\)</span> 的解。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;type of A:&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># x is solution of Ax=b</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;right-hand-side defined as:&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;verify A @ x gives same:&#39;</span><span class="p">,</span> <span class="n">A</span> <span class="o">@</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type of A: &lt;class &#39;scipy.sparse._csc.csc_matrix&#39;&gt;
right-hand-side defined as: [0 1 2 3]
verify A @ x gives same: [0. 1. 2. 3.]
</pre></div>
</div>
</div>
</div>
<p>稀疏矩阵的主要优点是可以解决比完整矩阵大得多的问题，因为只存储非零的（少量的）元素。求解器 <code class="docutils literal notranslate"><span class="pre">spsolve</span></code> 也利用了矩阵的稀疏性，通常会更快。</p>
</section>
<section id="id11">
<h2>练习 8：稀疏矩阵<a class="headerlink" href="#id11" title="Link to this heading">#</a></h2>
<p>重新进行练习 5，但这次使用 <em>稀疏</em> 矩阵。使用参数 <span class="math notranslate nohighlight">\(h_1^*=42\)</span>，<span class="math notranslate nohighlight">\(h_2^*=40\)</span>，<span class="math notranslate nohighlight">\(N=10000\)</span>。其他参数与练习 2 相同。创建两条运河之间的水头图。</p>
<p><strong>警告</strong>：当您尝试使用常规（完整）矩阵和 <span class="math notranslate nohighlight">\(N=10000\)</span> 解决该问题时，可能会耗尽计算机内存，求解可能需要 <em>很</em> 长时间，或者您的程序可能会挂起。请勿尝试此操作，但如果您意外地这样做并且您的笔记本无法恢复，请尝试点击菜单栏顶部的 ‘Kernel’，然后点击 ‘Restart’。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">diags</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span> 
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">D</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">h1star</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">h2star</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">P</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dplus1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dmin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dmin1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">diags</span><span class="p">([</span><span class="n">dmin1</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">dplus1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csc&#39;</span><span class="p">)</span>
<span class="n">delx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">P</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1star</span>
<span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h2star</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;node number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;head (m)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/19a4c6fa0644cb2e407934e8c5ffacedca926c802e8e1f958e322a11002d7d46.png" src="../../../../_images/19a4c6fa0644cb2e407934e8c5ffacedca926c802e8e1f958e322a11002d7d46.png" />
</div>
</div>
<p><a href="#ex8answer">Answers to Exercise 8</a></p>
</section>
<section id="solutions-to-the-exercises">
<h2>Solutions to the exercises<a class="headerlink" href="#solutions-to-the-exercises" title="Link to this heading">#</a></h2>
<p><a name="ex1answer">Answers to Exercise 1</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> \
           <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># Store one row at a time</span>
    <span class="n">rhs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a,b,c,d: &#39;</span><span class="p">,</span><span class="n">sol</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">sol</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">sol</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;wave&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#back1">Back to Exercise 1</a></p>
<p><a name="ex2answer">Answers to Exercise 2</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fpoly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">rv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">rv</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fpoly</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#back2">Back to Exercise 2</a></p>
<p><a name="ex3answer">Answers to Exercise 3</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solvepoly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">mat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpoly</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">par</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">par</span>
    
<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">solvepoly</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#back3">Back to Exercise 3</a></p>
<p><a name="ex4answer">Answers to Exercise 4</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fpolyeval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">rv</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">rv</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fpolyeval</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">fpolyeval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fitted poly&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#back4">Back to Exercise 4</a></p>
<p><a name="ex5answer">Answers to Exercise 5</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">D</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">h1star</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">h2star</span> <span class="o">=</span> <span class="mi">22</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">P</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>

<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># main diagonal</span>
<span class="n">d0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># first value of main diagonal is 1</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># last value of main diagonal is 1</span>
<span class="n">dplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># diagonal right above main diagonal, position 1</span>
<span class="n">dplus1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># first value of diagonal is 0</span>
<span class="n">dmin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># diagonal right below main diagonal, position -1</span>
<span class="n">dmin1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># last value of diagonal is 0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dplus1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dmin1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Right hand side</span>
<span class="n">delx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">P</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1star</span>
<span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h2star</span>
<span class="c1"># Solve for the head and plot</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x (m)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;head (m)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum head &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># m^2/s</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># m</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">delt</span> <span class="o">=</span> <span class="mf">4e4</span>  <span class="c1"># seconds</span>
<span class="c1">#</span>
<span class="n">delz</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">delz</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">cv</span> <span class="o">*</span> <span class="n">delt</span><span class="p">)</span>

<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dm1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dp1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">*</span> <span class="n">p</span>
        <span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">delz</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; timesteps&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum value after&#39;</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;timesteps is:&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Consolidation&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#back5">Back to Exercise 5</a></p>
<p><a name="ex6answer">Answers to Exercise 6</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># m^2/s</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># m</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">delt</span> <span class="o">=</span> <span class="mf">4e4</span>  <span class="c1"># seconds</span>
<span class="c1">#</span>
<span class="n">delz</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">delz</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">cv</span> <span class="o">*</span> <span class="n">delt</span><span class="p">)</span>

<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">dm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">dm1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dp1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dm1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Ainv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">*</span> <span class="n">p</span>
        <span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Ainv</span> <span class="o">@</span> <span class="n">rhs</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">delz</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; timesteps&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;maximum value after&#39;</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;timesteps is:&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Consolidation&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#back7">Back to Exercise 7</a></p>
<p><a name="ex8answer">Answers to Exercise 8</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">diags</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span> 
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">D</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">h1star</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">h2star</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">P</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># main diagonal</span>
<span class="n">d0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># first value of main diagonal is 1</span>
<span class="n">d0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># last value of main diagonal is 1</span>
<span class="n">dplus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="c1"># diagonal right above main diagonal, position 1</span>
<span class="n">dplus1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># first value of diagonal is 0</span>
<span class="n">dmin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># diagonal right below main diagonal, position -1</span>
<span class="n">dmin1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># last value of diagonal is 0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">diags</span><span class="p">([</span><span class="n">dmin1</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">dplus1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csc&#39;</span><span class="p">)</span>
<span class="c1"># Right hand side</span>
<span class="n">delx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">P</span> <span class="o">*</span> <span class="n">delx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">D</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1star</span>
<span class="n">rhs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h2star</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;node number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;head (m)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><a href="#back8">Back to Exercise 8</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ml-basic\references\exploratory_computing_with_python_translated\notebook6_linear_systems"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Exploratory Computing with Python</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-6">Notebook 6: 线性方程组</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">构建和求解线性方程组</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#left-begin-array-ccc-x-1-2-x-1-1-x-2-2-x-2-1-x-3-2-x-3-1-end-array-right-left-begin-array-c-a-b-c-end-array-right">$
\left(
\begin{array}{ccc}
x_1^2 &amp; x_1 &amp; 1 \
x_2^2 &amp; x_2 &amp; 1 \
x_3^2 &amp; x_3 &amp; 1 \
\end{array}
\right)
\left(
\begin{array}{c}
a \b \c \
\end{array}
\right)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">练习 1. <a name="back1"></a>拟合波形</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">拟合任意多项式</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fpoly">练习 2. <a name="back2"></a><code class="docutils literal notranslate"><span class="pre">fpoly</span></code> 函数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solvepoly">练习 3. <a name="back3"></a><code class="docutils literal notranslate"><span class="pre">solvepoly</span></code> 函数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fpolyeval">练习 4. <a name="back3"></a><code class="docutils literal notranslate"><span class="pre">fpolyeval</span></code> 函数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">一维地下水流动</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">练习 5. <a name="back5"></a>两个沟渠之间的水头</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">固结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">练习 6. 一维固结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">矩阵的逆</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">练习 7. 重新审视一维固结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">稀疏矩阵</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">练习 8：稀疏矩阵</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solutions-to-the-exercises">Solutions to the exercises</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>